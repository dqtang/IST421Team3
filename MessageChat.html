<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>testChat</title>
<link href="testStyle.css" rel="stylesheet" type="text/css">
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		const params = new URLSearchParams(document.location.search);
			const id_token = params.get('id_token');

            const friendID = params.get('friend_id');

            const fName = params.get('fName');

            console.log(id_token);
            console.log(friendID);
            console.log(fName);


			function decodeJwtResponse(id_token){
								var base64Url = id_token.split('.')[1];
								var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
								var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
									return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
								}).join(''));
	
								return JSON.parse(jsonPayload);
							};
			const responsePayload = decodeJwtResponse(id_token);
	
			firstName = responsePayload.given_name;
			lastName = responsePayload.family_name;
			profileImageUrl = responsePayload.picture;
			email = responsePayload.email;
			SenderID = responsePayload.sub;
            console.log(SenderID);


	</script>
<body>
        <div id="wrapper">
            <div id="menu">
                <p class="welcome">Welcome, <b></b></p>
                <p class="logout"><a id="exit" onclick="homePage()">Exit Chat</a></p>
            </div>

            <div id="chatbox"></div>

            <form name="message" action="http://localhost/SendMessage.php" method="post">
                <input name="Messages" type="text" id="Messages" />
                <input name="submitmsg" type="submit" id="submitmsg" value="Send" />
                <input type="hidden" id = "SenderID" name = "SenderID"> 
				<input type="hidden" id = "ReceiverID" name ="ReceiverID" > 
				<input type="hidden" id = "id_token" name ="id_token"> 
                <input type="hidden" id = "fName" name ="fName"> 



            </form>
        </div>
        <script type="text/javascript">
            document.getElementById('id_token').value = id_token;	
            document.getElementById('ReceiverID').value = friendID;	
            document.getElementById('SenderID').value = SenderID;	
            document.getElementById('fName').value = fName;	
        function homePage(){
                        location.href = "http://localhost/Homepage.html?id_token="+id_token;
                    }    
        </script>


<script>
    const xhttp = new XMLHttpRequest();

    xhttp.open("POST", "http://localhost/messageLog.php", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("SenderID="+SenderID+"&ReceiverID="+friendID);
    xhttp.onload = function(){

        var json_test = this.responseText;
            console.log(json_test);
            
		$(document).ready(function() { 

        });

    };

</script>
    </body>
</html>
