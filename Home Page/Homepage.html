<!doctype html>
<html>

<head>
<meta charset="utf-8">
<title>Home Page</title>
</head>
<link href="homeP.css" rel="stylesheet" type="text/css">	

<body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		const params = new URLSearchParams(document.location.search);
			const id_token = params.get('id_token');
	
			function decodeJwtResponse(id_token){
								var base64Url = id_token.split('.')[1];
								var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
								var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
									return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
								}).join(''));
	
								return JSON.parse(jsonPayload);
							};
			const responsePayload = decodeJwtResponse(id_token);
	
			firstName = responsePayload.given_name;
			lastName = responsePayload.family_name;
			profileImageUrl = responsePayload.picture;
			email = responsePayload.email;
			gID = responsePayload.sub;
	</script>
	<header>
	<div class= "container1"><a  onclick="homePage()">Flex Media</a>
<input type ="text" placeholder="search" >



<a><img src="AddaPost.PNG" class ="new_post" width="38" height="31" onclick="uploadPage()"/></a>
<a ><img src="Home ICon.PNG" width="38" height="31" alt=""onclick="homePage()"/></a>
<p style="width: 100px">&nbsp; </p>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
</div>


<script>
	//Redirect Functions to include id_tokens
function uploadPage() {
    location.href = "http://localhost/upload.html?id_token="+id_token;
}

function homePage(){
	location.href = "http://localhost/Home Page/Homepage.html?id_token="+id_token;
}

</script>

		
</header>

	
<div> <a> <img class= "profilePic" alt="image" src="tech.PNG" id = "profilePic" width = "30px" height="30px"/> </a>
</div>

<div class="container2" > <a> <img src="tech.PNG"  width = "30px" height="30px"/> DT200</a>
</div>
<div class = "center">
<img src="tech.PNG" width="250" height="250" alt="" class="center"/>
<input type ="text" placeholder="comment...." class="center" >
</div>

	

<div class="container2" > <a> <img src="tech.PNG"  width = "30px" height="30px"/> DT200</a>
</div>
<script>
	//Change Profile Pic
	$(".profilePic").attr("src", profileImageUrl);
</script>
<div class = "center">
<img src="tech.PNG" width="250" height="250" alt="" class="center"/>
<input type ="text" placeholder="comment...." class="center" >
</div>
	
<div class="center" > <a> <img src="tech.PNG"  width = "30px" height="30px"/> DT200</a>
</div>
<div class = "center">
<img src="tech.PNG" width="250" height="250" alt="" class="center"/>
<input type ="text" placeholder="comment...." class="center" >
</div>

<div class="container3" id="ID"> <figcaption>Friends</figcaption> 
<p>__________________________________________________</p>

<list id ="list">

</list>
</div>

<script>
	const xhttp = new XMLHttpRequest();


	xhttp.open("POST", "http://localhost/Friendlist.php", true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send("gID="+gID);
	xhttp.onload = function(){
		//this.responseText is the JSON data
		//document.getElementById("space").innerHTML = this.responseText;
		var strFriend = this.responseText;
		//var jsonFriend = JSON.stringify(strFriend);

		var parse_json = JSON.parse(strFriend);
		//console.log(parse_json);
		//console.log("FriendID:" +parse_json[1].FriendID);


		var listDiv=document.getElementById('list');
		var ul=document.createElement('ul');


		for( var i=0; i<parse_json.length; ++i){
			const img = document.createElement('img');
			var li=document.createElement('li');

			img.src= parse_json[i].Profile_URL;
			li.innerHTML = parse_json[i].First_Name + " " +parse_json[i].Last_Name;


			li.setAttribute('id', i);
			li.setAttribute('friendID',  parse_json[i].FriendID);


			listImg = ul.appendChild(img) + ul.appendChild(li);
		};listDiv.appendChild(ul);
		

		$(document).ready(function() { 
   			$("#list li").click(function() {

			
			  var fID= $(this).attr('friendid');
			  location.href = "http:localhost/messageChat.html?friend_id=" + fID +"&id_token=" + id_token;
			
			});
});

	};

</script>

	
</body>
</html>